(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{"0ylO":function(t,e,i){"use strict";i.r(e),i.d(e,"AuthModule",function(){return C});var n=i("ofXK"),r=i("3Pt+"),c=i("tyNb"),s=i("fXoL"),o=i("8lDW"),a=i("JqCM");function b(t,e){if(1&t){const t=s.Ob();s.Nb(0,"li",12),s.Nb(1,"a",13),s.Xb("click",function(){s.mc(t);const i=e.$implicit;return s.bc(2).doAuthorize(i)}),s.uc(2),s.Mb(),s.Nb(3,"span",14),s.Nb(4,"button",15),s.Xb("click",function(){s.mc(t);const i=e.$implicit;return s.bc(2).delAccount(i)}),s.Rb(5,16),s.Mb(),s.Mb(),s.Mb()}if(2&t){const t=e.$implicit;s.xb(2),s.vc(t)}}function l(t,e){if(1&t){const t=s.Ob();s.Nb(0,"div"),s.Nb(1,"h4"),s.Rb(2,5),s.Mb(),s.Nb(3,"div",6),s.sc(4,b,6,1,"li",7),s.Mb(),s.Nb(5,"button",8),s.Xb("click",function(){return s.mc(t),s.bc().doAuthorize()}),s.Rb(6,9),s.Mb(),s.Nb(7,"a",10),s.Rb(8,11),s.Mb(),s.Mb()}if(2&t){const t=s.bc();s.xb(4),s.gc("ngForOf",t.accounts)}}let u=(()=>{class t{constructor(t,e,i){this.authService=t,this.router=e,this.spinner=i,this.loginModel={username:"",password:""},this.accounts=[],this.showAccountPanel=!1,this.spinner.show(),this.accounts=this.authService.loggedAccounts(),this.accounts.length<1?location.href=this.authService.getAuthorizeUrl(this.authService.redirectUrl):(this.spinner.hide(),this.showAccountPanel=!0)}doAuthorize(t=""){this.spinner.show(),location.href=this.authService.getAuthorizeUrl(this.authService.redirectUrl,t)}delAccount(t){this.authService.delAccount(t),this.accounts=this.authService.loggedAccounts()}}return t.\u0275fac=function(e){return new(e||t)(s.Ib(o.a),s.Ib(c.f),s.Ib(a.c))},t.\u0275cmp=s.Cb({type:t,selectors:[["app-login"]],decls:5,vars:1,consts:function(){let t,e,i,n;return t=$localize`:␟a32c605573883f2ecc05f4670ac2819d80827b86␟3534256569610633327:选择账户`,e=$localize`:␟7ce53d53cbead1cc198c7a6509071b565c6e5690␟5605937061539126007:使用其他账户`,i=$localize`:␟c6a564e7f80ae6d03b06bd27532d94cc7703ff77␟2571824514132400882: 返回 `,n=$localize`:␟08254f4ac965519b9a0befb43fd82bd6fa72a7af␟1329392431125715413:删除`,[[1,"container"],[1,"row"],[1,"col","mt-4","px-4",2,"margin","auto"],[4,"ngIf"],["size","default","color","#fff","type","ball-beat"],t,[1,"list-group","list-group-flush"],["class","list-group-item d-flex justify-content-between align-items-center",4,"ngFor","ngForOf"],["type","button",1,"btn","btn-primary","mt-3","btn-block",3,"click"],e,["routerLink","/",1,"btn","btn-light","btn-block","mt-3"],i,[1,"list-group-item","d-flex","justify-content-between","align-items-center"],["href","javascript:void(0)",3,"click"],[1,"badge-pill"],["type","button",3,"click"],n]},template:function(t,e){1&t&&(s.Nb(0,"div",0),s.Nb(1,"div",1),s.Nb(2,"div",2),s.sc(3,l,9,1,"div",3),s.Mb(),s.Mb(),s.Mb(),s.Jb(4,"ngx-spinner",4)),2&t&&(s.xb(3),s.gc("ngIf",e.showAccountPanel))},directives:[n.k,a.a,n.j,c.h],styles:[""]}),t})(),d=(()=>{class t{constructor(t,e,i,n){this.router=t,this.route=e,this.authService=i,this.spinner=n,this.queryParams={},this.spinner.show(),location.hash.substr(1).split("&").forEach(t=>{var e=t.split("=");this.queryParams[e[0]]=e[1]}),this.queryParams.access_token&&(this.queryParams.state&&(this.authService.redirectUrl=this.queryParams.state),this.route.navigateByUrl("/auth2/signin?access_token="+this.queryParams.access_token))}}return t.\u0275fac=function(e){return new(e||t)(s.Ib(c.a),s.Ib(c.f),s.Ib(o.a),s.Ib(a.c))},t.\u0275cmp=s.Cb({type:t,selectors:[["app-authcallback"]],decls:1,vars:0,consts:[["size","default","color","#fff","type","ball-beat"]],template:function(t,e){1&t&&s.Jb(0,"ngx-spinner",0)},directives:[a.a],styles:[""]}),t})();var h=i("xfLO"),f=i("5eHb");function g(t,e){if(1&t&&(s.Nb(0,"li",19),s.Nb(1,"div",20),s.Jb(2,"input",21),s.Nb(3,"label",22),s.uc(4),s.Mb(),s.Mb(),s.Nb(5,"div",23),s.Nb(6,"small"),s.uc(7),s.Mb(),s.Mb(),s.Mb()),2&t){const t=e.$implicit;s.xb(2),s.ic("id","scopes_",t.value,""),s.hc("value",t.value),s.gc("disabled",t.required),s.xb(1),s.ic("for","scopes_",t.value,""),s.xb(1),s.vc(t.displayName),s.xb(3),s.vc(t.description)}}function p(t,e){if(1&t&&(s.Nb(0,"li",19),s.Nb(1,"div",20),s.Jb(2,"input",21),s.Nb(3,"label",22),s.uc(4),s.Mb(),s.Mb(),s.Nb(5,"div",23),s.Nb(6,"small"),s.uc(7),s.Mb(),s.Mb(),s.Mb()),2&t){const t=e.$implicit;s.xb(2),s.ic("id","scopes_",t.value,""),s.hc("value",t.value),s.gc("disabled",t.required),s.xb(1),s.ic("for","scopes_",t.value,""),s.xb(1),s.vc(t.displayName),s.xb(3),s.vc(t.description)}}function m(t,e){if(1&t&&(s.Nb(0,"div",13),s.Nb(1,"h6"),s.uc(2,"\u670d\u52a1"),s.Mb(),s.Nb(3,"ul",14),s.sc(4,p,8,6,"li",15),s.Mb(),s.Mb()),2&t){const t=s.bc(2);s.xb(4),s.gc("ngForOf",t.data.apiScopes)}}function v(t,e){if(1&t){const t=s.Ob();s.Nb(0,"div",2),s.Nb(1,"div",3),s.Nb(2,"div",4),s.Nb(3,"div",5),s.Jb(4,"img",6),s.Mb(),s.Nb(5,"h6",7),s.uc(6),s.Mb(),s.Nb(7,"div",8),s.Nb(8,"small"),s.uc(9),s.Mb(),s.Mb(),s.Mb(),s.Nb(10,"div",9),s.Nb(11,"h2",10),s.ac(),s.Nb(12,"svg",11),s.Jb(13,"path",12),s.Mb(),s.Mb(),s.Zb(),s.Nb(14,"small"),s.uc(15,"\u8bf7\u6c42\u4f60\u7684\u6388\u6743"),s.Mb(),s.Mb(),s.Nb(16,"div",4),s.Nb(17,"div",5),s.Jb(18,"img",6),s.Mb(),s.Nb(19,"h6",7),s.uc(20),s.Mb(),s.Mb(),s.Mb(),s.Nb(21,"div",13),s.Nb(22,"h6"),s.uc(23,"\u4e2a\u4eba\u4fe1\u606f"),s.Mb(),s.Nb(24,"ul",14),s.sc(25,g,8,6,"li",15),s.Mb(),s.Mb(),s.sc(26,m,5,1,"div",16),s.Nb(27,"div",13),s.Nb(28,"button",17),s.Xb("click",function(){return s.mc(t),s.bc().Consent()}),s.uc(29,"\u6388\u6743"),s.Mb(),s.Nb(30,"a",18),s.uc(31,"\u53d6\u6d88"),s.Mb(),s.Mb(),s.Mb()}if(2&t){const t=s.bc();s.xb(4),s.gc("src",t.data.clientLogoUrl,s.oc),s.xb(2),s.wc(" ",t.data.clientName," "),s.xb(3),s.vc(t.data.clientUrl),s.xb(9),s.gc("src",null==t.data.tenant?null:t.data.tenant.logoUri,s.oc),s.xb(2),s.vc(null==t.data.tenant?null:t.data.tenant.name),s.xb(5),s.gc("ngForOf",t.data.identityScopes),s.xb(1),s.gc("ngIf",t.data.apiScopes&&t.data.apiScopes.length>0)}}let M=(()=>{class t{constructor(t,e,i,n){this.route=t,this.oauthapp=e,this.spinner=i,this.toastr=n,this.data={},this.returnUrl="",this.onLoading=!1,this.spinner.show(),this.onLoading=!0,this.route.queryParams.subscribe(t=>{this.returnUrl=t.returnUrl,this.oauthapp.preConsent(this.returnUrl).subscribe(t=>{this.spinner.hide(),this.onLoading=!1,200==t.code?this.data=t.data:this.toastr.error(t.codeName,t.message,{timeOut:800,progressBar:!1})})})}Consent(){var t=this.data.identityScopes.filter(t=>t.checked).map(t=>t.value),e=this.data.apiScopes.filter(t=>t.checked).map(t=>t.value),i=t.concat(e);this.spinner.show(),this.oauthapp.Consent(this.returnUrl,i).subscribe(t=>{if(200!=t.code)return this.toastr.error(t.message,t.codeName,{timeOut:800,progressBar:!1}),void this.spinner.hide();location.href=this.returnUrl})}}return t.\u0275fac=function(e){return new(e||t)(s.Ib(c.a),s.Ib(h.a),s.Ib(a.c),s.Ib(f.b))},t.\u0275cmp=s.Cb({type:t,selectors:[["app-consent"]],decls:2,vars:1,consts:[["size","default","color","#fff","type","ball-beat"],["class","container",4,"ngIf"],[1,"container"],[1,"row","text-center","my-4"],[1,"col-4"],[1,"client-logo"],["width","64px",1,"border","bg-white","p-1","rounded-circle",3,"src"],[1,"mt-2"],[1,"text-muted"],[1,"col-4","text-muted"],[1,"mt-3"],["width","1em","height","1em","viewBox","0 0 16 16","fill","currentColor","xmlns","http://www.w3.org/2000/svg",1,"bi","bi-arrow-left-right"],["fill-rule","evenodd","d","M1 11.5a.5.5 0 0 0 .5.5h11.793l-3.147 3.146a.5.5 0 0 0 .708.708l4-4a.5.5 0 0 0 0-.708l-4-4a.5.5 0 0 0-.708.708L13.293 11H1.5a.5.5 0 0 0-.5.5zm14-7a.5.5 0 0 1-.5.5H2.707l3.147 3.146a.5.5 0 1 1-.708.708l-4-4a.5.5 0 0 1 0-.708l4-4a.5.5 0 1 1 .708.708L2.707 4H14.5a.5.5 0 0 1 .5.5z"],[1,"form-group"],[1,"list-group","list-group-flush"],["class","list-group-item",4,"ngFor","ngForOf"],["class","form-group",4,"ngIf"],["type","button",1,"btn","btn-primary","btn-block",3,"click"],["routerLink","/",1,"btn","btn-light","btn-block"],[1,"list-group-item"],[1,"form-check"],["type","checkbox","name","ScopesConsented","checked","checked",1,"form-check-input",3,"id","value","disabled"],[1,"form-check-label",3,"for"],[1,"consent-description"]],template:function(t,e){1&t&&(s.Jb(0,"ngx-spinner",0),s.sc(1,v,32,7,"div",1)),2&t&&(s.xb(1),s.gc("ngIf",!e.onLoading))},directives:[a.a,n.k,n.j,c.h],styles:[""]}),t})();var N=i("AytR");const x=function(t,e){return{"is-valid":t,"is-invalid":e}};function y(t,e){if(1&t){const t=s.Ob();s.Nb(0,"div",7),s.Nb(1,"label",23),s.Rb(2,24),s.Mb(),s.Nb(3,"input",25,26),s.Xb("ngModelChange",function(e){return s.mc(t),s.bc().loginModel.username=e}),s.Mb(),s.Nb(5,"small",27),s.Rb(6,28),s.Mb(),s.Nb(7,"div",12),s.Rb(8,29),s.Mb(),s.Mb()}if(2&t){const t=s.lc(4),e=s.bc();s.xb(3),s.gc("ngClass",s.jc(3,x,t.valid,t.invalid&&t.dirty))("ngModel",e.loginModel.username),s.xb(4),s.gc("hidden",t.valid)}}function k(t,e){if(1&t&&(s.Nb(0,"div",30),s.Jb(1,"img",31),s.Mb(),s.Nb(2,"div",32),s.Nb(3,"h4"),s.uc(4),s.Mb(),s.Mb()),2&t){const t=s.bc();s.xb(4),s.vc(t.loginModel.username)}}function w(t,e){1&t&&(s.Nb(0,"a",33),s.Rb(1,34),s.Mb())}function I(t,e){1&t&&(s.Nb(0,"a",35),s.Rb(1,36),s.Mb())}function U(t,e){if(1&t){const t=s.Ob();s.Nb(0,"a",38),s.Xb("click",function(){s.mc(t);const i=e.$implicit;return s.bc(2).doExternalLogin(i)}),s.uc(1),s.Mb()}if(2&t){const t=e.$implicit;s.xb(1),s.vc(t)}}function L(t,e){if(1&t&&(s.Nb(0,"div"),s.Jb(1,"hr"),s.sc(2,U,2,1,"a",37),s.Mb()),2&t){const t=s.bc();s.xb(2),s.gc("ngForOf",t.logins)}}let R=(()=>{class t{constructor(t,e,i,n,r){this.route=t,this.router=e,this.authService=i,this.toastr=n,this.spinner=r,this.loginModel={username:"",password:""},this.returnUrl="",this.logins=[],this.loginHintFlag=!1,this.externalLoginUrl=N.a.identity.server+"/Authing/ExternalLogin",this.externalLoginReturnUrl="",this.getExternalLogins(),this.route.queryParams.subscribe(t=>{if(t.ReturnUrl){this.returnUrl=t.ReturnUrl,this.externalLoginReturnUrl=encodeURIComponent(t.ReturnUrl);try{this.loginModel.username=this.returnUrl.split("&").filter(t=>"loginHint"==t.split("=")[0])[0].split("=")[1],this.loginModel.username&&(this.loginHintFlag=!0)}catch(e){}}else t.access_token?this.signInByAccessToken(t.access_token):this.toastr.error("ReturnUrl is null!")})}getExternalLogins(){this.authService.externalLogins().subscribe(t=>{this.logins=t.data})}doExternalLogin(t){this.spinner.show(),location.href=`${this.externalLoginUrl}?provider=${t}&returnUrl=${this.externalLoginReturnUrl}`}signInByAccessToken(t){this.spinner.show(),this.authService.loginByAccesstoken(t).add(()=>{if(this.authService.isLoggedIn){let t=this.authService.redirectUrl?this.router.parseUrl(this.authService.redirectUrl):"/";this.router.navigateByUrl(t,{queryParamsHandling:"preserve",preserveFragment:!0}),this.spinner.hide()}}).unsubscribe()}keyUp(t){if(13==t.keyCode){if(!this.loginModel.username||!this.loginModel.password)return;this.login()}}login(){this.spinner.show(),this.authService.signIn(this.loginModel.username,this.loginModel.password,this.returnUrl).subscribe(t=>{200==t.code&&1==t.data.succeeded?(this.authService.addAccount(this.loginModel.username),setTimeout(()=>{location.href=this.returnUrl},200)):(this.spinner.hide(),this.toastr.error("\u767b\u9646\u5931\u8d25\uff0c\u8d26\u53f7\u6216\u5bc6\u7801\u9519\u8bef","error"))})}}return t.\u0275fac=function(e){return new(e||t)(s.Ib(c.a),s.Ib(c.f),s.Ib(o.a),s.Ib(f.b),s.Ib(a.c))},t.\u0275cmp=s.Cb({type:t,selectors:[["app-signin"]],decls:27,vars:12,consts:function(){let t,e,i,n,r,c,s,o,a;return t=$localize`:␟18d001d6c612989165119e9a66c4f9da4d3e6ea4␟4161378947924066637:登陆`,e=$localize`:␟125849fb67b2f0af5ab31d4577126fcd52c4dcb6␟6971624281171557374:密码`,i=$localize`:␟49b4213f881402c9d8c814290025246f9f6e8a9c␟8943156472912178739:password is required`,n=$localize`:␟4da7c62228fbb3b416e53b8347175b7c46d56e39␟8160267814243826092: 登陆 `,r=$localize`:␟0115e0ed1b079ec138ed51b29c8e203921fb272b␟6363998355026114303:账号`,c=$localize`:␟ee82ca7d2108fb5cb3913a37a26714b36018a2ca␟4180909983048484744:请输入您的邮箱账号/手机号`,s=$localize`:␟cfea8a7e63b5e3b4f40909271c5e83879ff04b5e␟3569211035626562623:username is required`,o=$localize`:␟62bf0844be94cde0b82acbf71118d2ff6705400f␟490096644169324081: 返回 `,a=$localize`:␟bb8ff84eb42e6fd0c1fae0b95a9698b3ecdd60d7␟3176755235166645712: 返回 `,[[1,"container"],[1,"row"],[1,"col","mt-4","px-4",2,"margin","auto"],t,["loginForm","ngForm"],["class","form-group",4,"ngIf","ngIfElse"],["templateName",""],[1,"form-group"],["for","password"],e,["id","password","type","password","name","password","required","",1,"form-control",3,"ngClass","ngModel","ngModelChange","keyup"],["password","ngModel"],[1,"invalid-feedback",3,"hidden"],i,[1,"d-flex"],[1,"flex-fill"],[2,"position","relative"],["type","button",1,"btn","btn-primary","btn-block","mt-3",3,"disabled","click"],n,["routerLink","/","class","btn btn-light btn-block mt-3",4,"ngIf","ngIfElse"],["templateName2",""],[4,"ngIf"],["size","default","color","#fff","type","ball-beat"],["for","username"],r,["id","username","type","text","name","username","required","",1,"form-control",3,"ngClass","ngModel","ngModelChange"],["username","ngModel"],[1,"form-text","text-muted"],c,s,[1,"text-center"],["src","assets/user.png","width","64px",1,"border","p-1","rounded-circle","shadow","my-3"],[1,"form-group","text-center","pt-3","text-muted"],["routerLink","/",1,"btn","btn-light","btn-block","mt-3"],o,["routerLink","/auth2/login",1,"btn","btn-light","btn-block","mt-3"],a,["href","javascript:void(0)","class","btn btn-light border btn-sm m-2",3,"click",4,"ngFor","ngForOf"],["href","javascript:void(0)",1,"btn","btn-light","border","btn-sm","m-2",3,"click"]]},template:function(t,e){if(1&t&&(s.Nb(0,"div",0),s.Nb(1,"div",1),s.Nb(2,"div",2),s.Nb(3,"h4"),s.Rb(4,3),s.Mb(),s.Nb(5,"form",null,4),s.sc(7,y,9,6,"div",5),s.sc(8,k,5,1,"ng-template",null,6,s.tc),s.Nb(10,"div",7),s.Nb(11,"label",8),s.Rb(12,9),s.Mb(),s.Nb(13,"input",10,11),s.Xb("ngModelChange",function(t){return e.loginModel.password=t})("keyup",function(t){return e.keyUp(t)}),s.Mb(),s.Nb(15,"div",12),s.Rb(16,13),s.Mb(),s.Mb(),s.Nb(17,"section",14),s.Nb(18,"div",15),s.Nb(19,"div",16),s.Nb(20,"button",17),s.Xb("click",function(){return e.login()}),s.Rb(21,18),s.Mb(),s.sc(22,w,2,0,"a",19),s.sc(23,I,2,0,"ng-template",null,20,s.tc),s.sc(25,L,3,1,"div",21),s.Mb(),s.Mb(),s.Mb(),s.Mb(),s.Mb(),s.Mb(),s.Mb(),s.Jb(26,"ngx-spinner",22)),2&t){const t=s.lc(6),i=s.lc(9),n=s.lc(14),r=s.lc(24);s.xb(7),s.gc("ngIf",!e.loginHintFlag)("ngIfElse",i),s.xb(6),s.gc("ngClass",s.jc(9,x,n.valid,n.invalid&&n.dirty))("ngModel",e.loginModel.password),s.xb(2),s.gc("hidden",n.valid),s.xb(5),s.gc("disabled",!t.form.valid),s.xb(2),s.gc("ngIf",!e.loginHintFlag)("ngIfElse",r),s.xb(3),s.gc("ngIf",!e.loginHintFlag)}},directives:[r.h,r.d,r.e,n.k,r.a,r.g,n.i,r.c,r.f,a.a,c.h,n.j],styles:[""]}),t})();var $=i("tk/3");const z=[{path:"",redirectTo:"signin"},{path:"login",component:u},{path:"signin",component:R},{path:"signin-callback",component:d},{path:"error",component:(()=>{class t{constructor(t,e){this.route=t,this.http=e,this.errorId="",this.data={},t.queryParams.subscribe(t=>{this.errorId=t.errorId,this.getErrorReport()})}getErrorReport(){this.http.get(`${N.a.identity.sso_server}/api/authing/ErrorReport?errorId=${this.errorId}`).subscribe(t=>{this.data=t.data})}}return t.\u0275fac=function(e){return new(e||t)(s.Ib(c.a),s.Ib($.b))},t.\u0275cmp=s.Cb({type:t,selectors:[["app-error"]],decls:20,vars:7,consts:function(){let t;return t=$localize`:␟7c180ca29987c30365d00e24d798ff9004bc26a4␟7581476335968291359:返回首页`,[[1,"container"],[1,"row"],[1,"col"],[1,"card","my-3"],[1,"card-header"],[1,"card-body"],[1,"card-footer"],[1,"text-muted","float-right"],["routerLink","/",1,"btn","btn-primary","btn-block"],t]},template:function(t,e){1&t&&(s.Nb(0,"div",0),s.Nb(1,"div",1),s.Nb(2,"div",2),s.Nb(3,"div",3),s.Nb(4,"div",4),s.uc(5),s.Mb(),s.Nb(6,"div",5),s.Nb(7,"h6"),s.uc(8),s.Mb(),s.Nb(9,"p"),s.uc(10),s.Mb(),s.Jb(11,"hr"),s.Nb(12,"pre"),s.uc(13),s.cc(14,"json"),s.Mb(),s.Mb(),s.Nb(15,"div",6),s.Nb(16,"small",7),s.uc(17),s.Mb(),s.Mb(),s.Mb(),s.Nb(18,"a",8),s.Rb(19,9),s.Mb(),s.Mb(),s.Mb(),s.Mb()),2&t&&(s.xb(5),s.wc(" ",e.data.clientId," "),s.xb(3),s.vc(e.data.error),s.xb(2),s.vc(e.data.errorDescription),s.xb(3),s.vc(s.dc(14,5,e.data)),s.xb(4),s.wc("requestId:",e.data.requestId,""))},directives:[c.h],pipes:[n.e],styles:[""]}),t})()},{path:"consent",component:M}];let S=(()=>{class t{}return t.\u0275mod=s.Gb({type:t}),t.\u0275inj=s.Fb({factory:function(e){return new(e||t)},imports:[[c.i.forChild(z)],c.i]}),t})(),C=(()=>{class t{}return t.\u0275mod=s.Gb({type:t}),t.\u0275inj=s.Fb({factory:function(e){return new(e||t)},imports:[[n.b,r.b,S,a.b]]}),t})()}}]);