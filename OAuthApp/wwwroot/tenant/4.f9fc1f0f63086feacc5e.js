(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{"0ylO":function(e,t,r){"use strict";r.r(t),r.d(t,"AuthModule",function(){return w});var i=r("ofXK"),s=r("3Pt+"),n=r("tyNb"),a=r("fXoL"),c=r("8lDW"),o=r("JqCM");let b=(()=>{class e{constructor(e,t,r,i){this.router=e,this.route=t,this.authService=r,this.spinner=i,this.queryParams={},this.spinner.show(),location.hash.substr(1).split("&").forEach(e=>{var t=e.split("=");this.queryParams[t[0]]=t[1]}),this.queryParams.access_token&&(this.queryParams.state&&(this.authService.redirectUrl=this.queryParams.state),this.route.navigateByUrl("/auth2/signin?access_token="+this.queryParams.access_token))}}return e.\u0275fac=function(t){return new(t||e)(a.Ib(n.a),a.Ib(n.f),a.Ib(c.a),a.Ib(o.c))},e.\u0275cmp=a.Cb({type:e,selectors:[["app-authcallback"]],decls:1,vars:0,consts:[["size","default","color","#fff","type","ball-beat"]],template:function(e,t){1&e&&a.Jb(0,"ngx-spinner",0)},directives:[o.a],styles:[""]}),e})();var l=r("AytR"),d=r("tk/3"),u=r("b6Qw");let h=(()=>{class e{constructor(e,t){this.http=e,this.cookies=t}preConsent(e){return this.http.post(l.a.identity.server+"/Authing/PreConsent",{returnUrl:e})}Consent(e,t,r=""){return this.http.post(l.a.identity.server+"/Authing/Consent",{Scopes:t,Remember:!0,Description:r,ReturnUrl:e},{withCredentials:!0})}Grants(){return this.http.get(l.a.identity.server+"/Authing/Grants",{withCredentials:!0})}Revoke(e){return this.http.delete(l.a.identity.server+"/Authing/Revoke?clientId="+e,{withCredentials:!0})}}return e.\u0275fac=function(t){return new(t||e)(a.Sb(d.b),a.Sb(u.a))},e.\u0275prov=a.Eb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var p=r("5eHb");function f(e,t){if(1&e&&(a.Nb(0,"li",16),a.Nb(1,"div",17),a.Jb(2,"input",18),a.Nb(3,"label",19),a.sc(4),a.Mb(),a.Mb(),a.Nb(5,"div",20),a.Nb(6,"small"),a.sc(7),a.Mb(),a.Mb(),a.Mb()),2&e){const e=t.$implicit;a.xb(2),a.gc("id","scopes_",e.value,""),a.fc("value",e.value),a.ec("disabled",e.required),a.xb(1),a.gc("for","scopes_",e.value,""),a.xb(1),a.tc(e.displayName),a.xb(3),a.tc(e.description)}}function g(e,t){if(1&e&&(a.Nb(0,"li",16),a.Nb(1,"div",17),a.Jb(2,"input",18),a.Nb(3,"label",19),a.sc(4),a.Mb(),a.Mb(),a.Nb(5,"div",20),a.Nb(6,"small"),a.sc(7),a.Mb(),a.Mb(),a.Mb()),2&e){const e=t.$implicit;a.xb(2),a.gc("id","scopes_",e.value,""),a.fc("value",e.value),a.ec("disabled",e.required),a.xb(1),a.gc("for","scopes_",e.value,""),a.xb(1),a.tc(e.displayName),a.xb(3),a.tc(e.description)}}let m=(()=>{class e{constructor(e,t,r,i){this.route=e,this.oauthapp=t,this.spinner=r,this.toastr=i,this.data={},this.returnUrl="",this.spinner.show(),this.route.queryParams.subscribe(e=>{this.returnUrl=e.returnUrl,this.oauthapp.preConsent(this.returnUrl).subscribe(e=>{this.spinner.hide(),200==e.code?this.data=e.data:this.toastr.error(e.codeName,e.message,{timeOut:800,progressBar:!1})})})}Consent(){var e=this.data.identityScopes.filter(e=>e.checked).map(e=>e.value),t=this.data.apiScopes.filter(e=>e.checked).map(e=>e.value),r=e.concat(t);this.spinner.show(),this.oauthapp.Consent(this.returnUrl,r).subscribe(e=>{if(200!=e.code)return this.toastr.error(e.message,e.codeName,{timeOut:800,progressBar:!1}),void this.spinner.hide();location.href=this.returnUrl})}}return e.\u0275fac=function(t){return new(t||e)(a.Ib(n.a),a.Ib(h),a.Ib(o.c),a.Ib(p.b))},e.\u0275cmp=a.Cb({type:e,selectors:[["app-consent"]],decls:34,vars:6,consts:[["size","default","color","#fff","type","ball-beat"],[1,"container"],[1,"row","text-center","my-3"],[1,"col-4"],[1,"client-logo"],["width","64px",1,"border","bg-white","p-1","rounded-circle",3,"src"],[1,"mt-2"],[1,"col-4","text-muted"],[1,"mt-3"],["width","1em","height","1em","viewBox","0 0 16 16","fill","currentColor","xmlns","http://www.w3.org/2000/svg",1,"bi","bi-arrow-left-right"],["fill-rule","evenodd","d","M1 11.5a.5.5 0 0 0 .5.5h11.793l-3.147 3.146a.5.5 0 0 0 .708.708l4-4a.5.5 0 0 0 0-.708l-4-4a.5.5 0 0 0-.708.708L13.293 11H1.5a.5.5 0 0 0-.5.5zm14-7a.5.5 0 0 1-.5.5H2.707l3.147 3.146a.5.5 0 1 1-.708.708l-4-4a.5.5 0 0 1 0-.708l4-4a.5.5 0 1 1 .708.708L2.707 4H14.5a.5.5 0 0 1 .5.5z"],[1,"form-group"],[1,"list-group","list-group-flush"],["class","list-group-item",4,"ngFor","ngForOf"],["type","button",1,"btn","btn-primary","btn-block",3,"click"],["type","button",1,"btn","btn-light","btn-block"],[1,"list-group-item"],[1,"form-check"],["type","checkbox","name","ScopesConsented","checked","checked",1,"form-check-input",3,"id","value","disabled"],[1,"form-check-label",3,"for"],[1,"consent-description"]],template:function(e,t){1&e&&(a.Jb(0,"ngx-spinner",0),a.Nb(1,"div",1),a.Nb(2,"div",2),a.Nb(3,"div",3),a.Nb(4,"div",4),a.Jb(5,"img",5),a.Mb(),a.Nb(6,"h6",6),a.sc(7),a.Mb(),a.Mb(),a.Nb(8,"div",7),a.Nb(9,"h2",8),a.Yb(),a.Nb(10,"svg",9),a.Jb(11,"path",10),a.Mb(),a.Mb(),a.Xb(),a.Nb(12,"small"),a.sc(13,"\u8bf7\u6c42\u4f60\u7684\u6388\u6743"),a.Mb(),a.Mb(),a.Nb(14,"div",3),a.Nb(15,"div",4),a.Jb(16,"img",5),a.Mb(),a.Nb(17,"h6",6),a.sc(18),a.Mb(),a.Mb(),a.Mb(),a.Nb(19,"div",11),a.Nb(20,"h6"),a.sc(21,"\u4e2a\u4eba\u4fe1\u606f"),a.Mb(),a.Nb(22,"ul",12),a.qc(23,f,8,6,"li",13),a.Mb(),a.Mb(),a.Nb(24,"div",11),a.Nb(25,"h6"),a.sc(26,"\u670d\u52a1"),a.Mb(),a.Nb(27,"ul",12),a.qc(28,g,8,6,"li",13),a.Mb(),a.Mb(),a.Nb(29,"div",11),a.Nb(30,"button",14),a.Vb("click",function(){return t.Consent()}),a.sc(31,"\u6388\u6743"),a.Mb(),a.Nb(32,"button",15),a.sc(33,"\u53d6\u6d88"),a.Mb(),a.Mb(),a.Mb()),2&e&&(a.xb(5),a.ec("src",t.data.clientLogoUrl,a.mc),a.xb(2),a.uc(" ",t.data.clientName," "),a.xb(9),a.ec("src",null==t.data.tenant?null:t.data.tenant.logoUri,a.mc),a.xb(2),a.tc(null==t.data.tenant?null:t.data.tenant.name),a.xb(5),a.ec("ngForOf",t.data.identityScopes),a.xb(5),a.ec("ngForOf",t.data.apiScopes))},directives:[o.a,i.j],styles:[""]}),e})();var v=r("5CTH");const M=function(e,t){return{"is-valid":e,"is-invalid":t}};function N(e,t){if(1&e&&(a.Nb(0,"span",13),a.sc(1),a.Mb()),2&e){const e=t.$implicit;a.xb(1),a.uc(" ",e," ")}}function y(e,t){if(1&e){const e=a.Ob();a.Nb(0,"div",7),a.Nb(1,"div",8),a.Nb(2,"h4"),a.Nb(3,"button",9),a.Vb("click",function(){a.kc(e);const r=t.$implicit;return a.Zb().revokeConsent(r.clientId)}),a.sc(4,"\u64a4\u9500"),a.Mb(),a.sc(5),a.Mb(),a.Mb(),a.Nb(6,"div",10),a.qc(7,N,2,1,"span",11),a.Nb(8,"p"),a.sc(9),a.Mb(),a.Mb(),a.Nb(10,"div",12),a.Nb(11,"small"),a.sc(12),a.Mb(),a.Mb(),a.Mb()}if(2&e){const e=t.$implicit;a.xb(5),a.uc(" ",e.clientId," "),a.xb(2),a.ec("ngForOf",e.scopes),a.xb(2),a.uc(" ",e.description," "),a.xb(3),a.vc("\u6388\u6743\u65f6\u95f4\uff1a",e.creationTime,"\uff0c\u5230\u671f\u65f6\u95f4\uff1a",e.expiration,"")}}const x=[{path:"",redirectTo:"signin"},{path:"signin",component:(()=>{class e{constructor(e,t,r,i,s){this.route=e,this.router=t,this.authService=r,this.toastr=i,this.spinner=s,this.loginModel={username:"",password:""},this.returnUrl="",this.route.queryParams.subscribe(e=>{e.ReturnUrl?this.returnUrl=e.ReturnUrl:e.access_token?this.signInByAccessToken(e.access_token):this.toastr.error("ReturnUrl is null!")})}signInByAccessToken(e){this.spinner.show(),this.authService.loginByAccesstoken(e).add(()=>{if(this.authService.isLoggedIn){let e=this.authService.redirectUrl?this.router.parseUrl(this.authService.redirectUrl):"/";this.router.navigateByUrl(e,{queryParamsHandling:"preserve",preserveFragment:!0}),this.spinner.hide()}}).unsubscribe()}keyUp(e){if(13==e.keyCode){if(!this.loginModel.username||!this.loginModel.password)return;this.login()}}login(){this.spinner.show(),this.authService.signIn(this.loginModel.username,this.loginModel.password,this.returnUrl).subscribe(e=>{200==e.code&&1==e.data.succeeded?location.href=this.returnUrl:(this.spinner.hide(),this.toastr.error(JSON.stringify(e.data),"error"))})}}return e.\u0275fac=function(t){return new(t||e)(a.Ib(n.a),a.Ib(n.f),a.Ib(c.a),a.Ib(p.b),a.Ib(o.c))},e.\u0275cmp=a.Cb({type:e,selectors:[["app-signin"]],decls:31,vars:13,consts:function(){let e,t,r,i,s,n,a,c;return e=$localize`:␟18d001d6c612989165119e9a66c4f9da4d3e6ea4␟4161378947924066637:登陆`,t=$localize`:␟0115e0ed1b079ec138ed51b29c8e203921fb272b␟6363998355026114303:账号`,r=$localize`:␟ee82ca7d2108fb5cb3913a37a26714b36018a2ca␟4180909983048484744:请输入您的邮箱账号/手机号`,i=$localize`:␟cfea8a7e63b5e3b4f40909271c5e83879ff04b5e␟3569211035626562623:username is required`,s=$localize`:␟125849fb67b2f0af5ab31d4577126fcd52c4dcb6␟6971624281171557374:密码`,n=$localize`:␟49b4213f881402c9d8c814290025246f9f6e8a9c␟8943156472912178739:password is required`,a=$localize`:␟4da7c62228fbb3b416e53b8347175b7c46d56e39␟8160267814243826092: 登陆 `,c=$localize`:␟62bf0844be94cde0b82acbf71118d2ff6705400f␟490096644169324081: 返回 `,[[1,"container"],[1,"row"],[1,"col","mt-3",2,"margin","auto"],e,["loginForm","ngForm"],[1,"form-group"],["for","username"],t,["id","username","type","text","name","username","required","",1,"form-control",3,"ngClass","ngModel","ngModelChange"],["username","ngModel"],[1,"form-text","text-muted"],r,[1,"invalid-feedback",3,"hidden"],i,["for","password"],s,["id","password","type","password","name","password","required","",1,"form-control",3,"ngClass","ngModel","ngModelChange","keyup"],["password","ngModel"],n,[1,"d-flex"],[1,"flex-fill"],[2,"position","relative"],["type","button",1,"btn","btn-primary","btn-block","mt-3",3,"disabled","click"],a,["routerLink","/",1,"btn","btn-light","btn-block","mt-3"],c,["size","default","color","#fff","type","ball-beat"]]},template:function(e,t){if(1&e&&(a.Nb(0,"div",0),a.Nb(1,"div",1),a.Nb(2,"div",2),a.Nb(3,"h4"),a.Rb(4,3),a.Mb(),a.Nb(5,"form",null,4),a.Nb(7,"div",5),a.Nb(8,"label",6),a.Rb(9,7),a.Mb(),a.Nb(10,"input",8,9),a.Vb("ngModelChange",function(e){return t.loginModel.username=e}),a.Mb(),a.Nb(12,"small",10),a.Rb(13,11),a.Mb(),a.Nb(14,"div",12),a.Rb(15,13),a.Mb(),a.Mb(),a.Nb(16,"div",5),a.Nb(17,"label",14),a.Rb(18,15),a.Mb(),a.Nb(19,"input",16,17),a.Vb("ngModelChange",function(e){return t.loginModel.password=e})("keyup",function(e){return t.keyUp(e)}),a.Mb(),a.Nb(21,"div",12),a.Rb(22,18),a.Mb(),a.Mb(),a.Nb(23,"section",19),a.Nb(24,"div",20),a.Nb(25,"div",21),a.Nb(26,"button",22),a.Vb("click",function(){return t.login()}),a.Rb(27,23),a.Mb(),a.Nb(28,"a",24),a.Rb(29,25),a.Mb(),a.Mb(),a.Mb(),a.Mb(),a.Mb(),a.Mb(),a.Mb(),a.Mb(),a.Jb(30,"ngx-spinner",26)),2&e){const e=a.jc(6),r=a.jc(11),i=a.jc(20);a.xb(10),a.ec("ngClass",a.hc(7,M,r.valid,r.invalid&&r.dirty))("ngModel",t.loginModel.username),a.xb(4),a.ec("hidden",r.valid),a.xb(5),a.ec("ngClass",a.hc(10,M,i.valid,i.invalid&&i.dirty))("ngModel",t.loginModel.password),a.xb(2),a.ec("hidden",i.valid),a.xb(5),a.ec("disabled",!e.form.valid)}},directives:[s.h,s.d,s.e,s.a,s.g,i.i,s.c,s.f,n.h,o.a],styles:[""]}),e})()},{path:"signin-callback",component:b},{path:"error",component:(()=>{class e{constructor(e,t){this.route=e,this.http=t,this.errorId="",this.data={},e.queryParams.subscribe(e=>{this.errorId=e.errorId,this.getErrorReport()})}getErrorReport(){this.http.get(`${l.a.identity.sso_server}/api/authing/ErrorReport?errorId=${this.errorId}`).subscribe(e=>{this.data=e.data})}}return e.\u0275fac=function(t){return new(t||e)(a.Ib(n.a),a.Ib(d.b))},e.\u0275cmp=a.Cb({type:e,selectors:[["app-error"]],decls:20,vars:7,consts:function(){let e;return e=$localize`:␟7c180ca29987c30365d00e24d798ff9004bc26a4␟7581476335968291359:返回首页`,[[1,"container"],[1,"row"],[1,"col"],[1,"card","my-3"],[1,"card-header"],[1,"card-body"],[1,"card-footer"],[1,"text-muted","float-right"],["routerLink","/",1,"btn","btn-primary","btn-block"],e]},template:function(e,t){1&e&&(a.Nb(0,"div",0),a.Nb(1,"div",1),a.Nb(2,"div",2),a.Nb(3,"div",3),a.Nb(4,"div",4),a.sc(5),a.Mb(),a.Nb(6,"div",5),a.Nb(7,"h6"),a.sc(8),a.Mb(),a.Nb(9,"p"),a.sc(10),a.Mb(),a.Jb(11,"hr"),a.Nb(12,"pre"),a.sc(13),a.ac(14,"json"),a.Mb(),a.Mb(),a.Nb(15,"div",6),a.Nb(16,"small",7),a.sc(17),a.Mb(),a.Mb(),a.Mb(),a.Nb(18,"a",8),a.Rb(19,9),a.Mb(),a.Mb(),a.Mb(),a.Mb()),2&e&&(a.xb(5),a.uc(" ",t.data.clientId," "),a.xb(3),a.tc(t.data.error),a.xb(2),a.tc(t.data.errorDescription),a.xb(3),a.tc(a.bc(14,5,t.data)),a.xb(4),a.uc("requestId:",t.data.requestId,""))},directives:[n.h],pipes:[i.e],styles:[""]}),e})()},{path:"consent",component:m},{path:"grants",component:(()=>{class e{constructor(e,t,r){this.oauthapp=e,this.spinner=t,this.toastr=r,this.data=[],this.getData()}getData(){this.spinner.show(),this.oauthapp.Grants().subscribe(e=>{this.spinner.hide(),this.data=e})}revokeConsent(e){this.spinner.show(),this.oauthapp.Revoke(e).subscribe(e=>{this.spinner.hide(),this.getData()})}}return e.\u0275fac=function(t){return new(t||e)(a.Ib(h),a.Ib(o.c),a.Ib(p.b))},e.\u0275cmp=a.Cb({type:e,selectors:[["app-grants"]],decls:7,vars:1,consts:function(){let e;return e=$localize`:␟7c180ca29987c30365d00e24d798ff9004bc26a4␟7581476335968291359:返回首页`,[["size","default","color","#fff","type","ball-beat"],[1,"container"],[1,"row"],[1,"col","pt-3"],["class","card",4,"ngFor","ngForOf"],["routerLink","/",1,"btn","btn-primary","btn-block","mt-3"],e,[1,"card"],[1,"card-header"],["type","button",1,"btn","btn-danger","btn-sm","float-right",3,"click"],[1,"card-body"],["class","badge badge-primary mx-1","style","font-size: 100%;",4,"ngFor","ngForOf"],[1,"card-footer","text-muted","text-right"],[1,"badge","badge-primary","mx-1",2,"font-size","100%"]]},template:function(e,t){1&e&&(a.Jb(0,"ngx-spinner",0),a.Nb(1,"div",1),a.Nb(2,"div",2),a.Nb(3,"div",3),a.qc(4,y,13,5,"div",4),a.Nb(5,"a",5),a.Rb(6,6),a.Mb(),a.Mb(),a.Mb(),a.Mb()),2&e&&(a.xb(4),a.ec("ngForOf",t.data))},directives:[o.a,i.j,n.h],styles:[""]}),e})(),canActivate:[v.a]}];let k=(()=>{class e{}return e.\u0275mod=a.Gb({type:e}),e.\u0275inj=a.Fb({factory:function(t){return new(t||e)},imports:[[n.i.forChild(x)],n.i]}),e})(),w=(()=>{class e{}return e.\u0275mod=a.Gb({type:e}),e.\u0275inj=a.Fb({factory:function(t){return new(t||e)},imports:[[i.b,s.b,k,o.b]]}),e})()}}]);